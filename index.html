<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raza Jumma Masjid - Ravetha Nagar</title>
    <meta name="theme-color" content="#064e3b">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=Noto+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">

    <style>
        body { font-family: 'Noto Sans', sans-serif; background-color: #f8fafc; background-image: radial-gradient(#166534 0.5px, transparent 0.5px); background-size: 20px 20px; }
        h1, h2, h3, .arabic-text, .surah-name { font-family: 'Amiri', serif; }
        .glass-panel { background: rgba(255,255,255,0.95); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.5); box-shadow: 0 10px 30px -10px rgba(0,0,0,0.1); }
        .prayer-card { transition: all 0.3s ease; position: relative; overflow: hidden; border: 1px solid #e2e8f0; }
        @keyframes pulse-green { 0% { box-shadow: 0 0 0 0 rgba(22,163,74,0.4); } 70% { box-shadow: 0 0 0 10px rgba(22,163,74,0); } 100% { box-shadow: 0 0 0 0 rgba(22,163,74,0); } }
        .prayer-card.running-now { background: linear-gradient(135deg,#ecfdf5 0%,#ffffff 100%); border: 2px solid #16a34a; transform: scale(1.05); z-index: 10; animation: pulse-green 2s infinite; }
        .prayer-card.running-now::after { content: 'Running Now'; position: absolute; top: 0; right: 0; background: #16a34a; color: white; font-size: 9px; font-weight: bold; padding: 3px 8px; border-bottom-left-radius: 8px; }
        .surah-item:hover { background-color: #f0fdf4; border-color: #16a34a; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* === AUTO SCROLL HIGHLIGHT === */
        @keyframes sectionGlow {
            0% { box-shadow: 0 0 0 0 rgba(22,163,74,0.5); }
            50% { box-shadow: 0 0 0 8px rgba(22,163,74,0.15); }
            100% { box-shadow: 0 0 0 0 rgba(22,163,74,0); }
        }
        .scroll-highlight { animation: sectionGlow 1.2s ease; outline: 2px solid #16a34a; outline-offset: 4px; border-radius: 24px; }

        /* === TWINKLE STARS === */
        @keyframes twinkle { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:0.2;transform:scale(0.5)} }

        /* === CONTACT PAGE SLIDE === */
        #contactPageModal { transition: transform 0.4s cubic-bezier(0.16,1,0.3,1); transform: translateY(100%); }
        #contactPageModal.open { transform: translateY(0); }

        /* === RUNNING EVENT BADGE === */
        .event-running { background: linear-gradient(135deg,#064e3b,#047857); border: 2px solid #10b981; }
        .event-upcoming { background: linear-gradient(135deg,#1e3a5f,#1d4ed8); border: 2px solid #60a5fa; }
        .event-ended { opacity: 0.6; filter: grayscale(0.5); }
        .running-badge { display: inline-flex; align-items: center; gap: 6px; background: #10b981; color: white; font-size: 10px; font-weight: 800; padding: 3px 10px; border-radius: 20px; text-transform: uppercase; letter-spacing: 0.1em; }
        @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.4} }
        .blink { animation: blink 1.4s infinite; }
    </style>
</head>
<body class="text-slate-800 min-h-screen flex flex-col">

    <!-- Zakat Modal -->
    <div id="zakatModal" class="fixed inset-0 bg-black/80 z-[70] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-3xl p-6 w-full max-w-md shadow-2xl relative overflow-hidden">
            <button onclick="document.getElementById('zakatModal').classList.add('hidden')" class="absolute top-4 right-4 text-gray-400 hover:text-red-500"><i class="fas fa-times fa-lg"></i></button>
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-3 text-amber-600"><i class="fas fa-calculator fa-2x"></i></div>
                <h3 class="text-2xl font-bold text-slate-800">Zakat Calculator</h3>
                <p class="text-xs text-slate-500">Calculate 2.5% of your eligible wealth</p>
            </div>
            <div class="space-y-4 max-h-[60vh] overflow-y-auto pr-2">
                <div><label class="text-xs font-bold text-slate-500 uppercase">Cash & Bank Balance</label><div class="flex items-center border rounded-lg px-3 bg-slate-50 focus-within:ring-2 ring-green-500"><span class="text-slate-400">‚Çπ</span><input type="number" id="z_cash" class="w-full p-3 bg-transparent outline-none" placeholder="0"></div></div>
                <div><label class="text-xs font-bold text-slate-500 uppercase">Gold & Silver Value</label><div class="flex items-center border rounded-lg px-3 bg-slate-50 focus-within:ring-2 ring-green-500"><span class="text-slate-400">‚Çπ</span><input type="number" id="z_gold" class="w-full p-3 bg-transparent outline-none" placeholder="0"></div></div>
                <div><label class="text-xs font-bold text-slate-500 uppercase">Any Investments & Shares</label><div class="flex items-center border rounded-lg px-3 bg-slate-50 focus-within:ring-2 ring-green-500"><span class="text-slate-400">‚Çπ</span><input type="number" id="z_invest" class="w-full p-3 bg-transparent outline-none" placeholder="0"></div></div>
                <div><label class="text-xs font-bold text-red-400 uppercase">Loans (appk upar koi karz hai tho o edhar daliya)</label><div class="flex items-center border border-red-100 rounded-lg px-3 bg-red-50 focus-within:ring-2 ring-red-500"><span class="text-red-400">‚Çπ</span><input type="number" id="z_debt" class="w-full p-3 bg-transparent outline-none" placeholder="0"></div></div>
            </div>
            <div class="mt-6 p-4 bg-green-50 rounded-xl border border-green-100 text-center">
                <p class="text-sm text-green-800 mb-1">Total Zakat Payable</p>
                <div class="text-3xl font-bold text-green-700" id="zakatResult">‚Çπ 0</div>
            </div>
            <button onclick="calculateZakat()" class="w-full mt-4 bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-xl shadow-lg transition">Calculate</button>
        </div>
    </div>

    <!-- Quran Modal -->
    <div id="quranModal" class="fixed inset-0 bg-slate-900/95 z-[80] hidden flex flex-col backdrop-blur-md">
        <div class="bg-white p-4 shadow-md flex justify-between items-center z-10">
            <h3 class="text-lg font-bold text-green-800 flex items-center gap-2"><i class="fas fa-book-open"></i> Al-Quran</h3>
            <button onclick="document.getElementById('quranModal').classList.add('hidden')" class="text-slate-500 hover:text-red-500 w-8 h-8 flex items-center justify-center bg-slate-100 rounded-full"><i class="fas fa-times"></i></button>
        </div>
        <div class="p-4 bg-slate-50 border-b">
            <input type="text" id="surahSearch" placeholder="Search Surah (e.g. Yasin)..." class="w-full p-3 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-green-500" oninput="filterSurahs()">
        </div>
        <div id="surahList" class="flex-grow overflow-y-auto p-4 space-y-2 pb-20"></div>
        <div id="readerView" class="hidden absolute inset-0 bg-white z-20 flex flex-col">
            <div class="bg-green-800 text-white p-4 shadow-md flex justify-between items-center">
                <button onclick="document.getElementById('readerView').classList.add('hidden')" class="text-white/80 hover:text-white"><i class="fas fa-arrow-left"></i> Back</button>
                <h3 id="readerTitle" class="font-bold font-serif text-lg">Surah</h3>
                <div class="w-6"></div>
            </div>
            <div id="readerContent" class="flex-grow overflow-y-auto p-6 space-y-6 pb-20 bg-[#fffdf5]"></div>
        </div>
    </div>

    <!-- Countdown Modal -->
    <div id="countdownModal" class="fixed inset-0 bg-black/60 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm" onclick="closeCountdown()">
        <div class="bg-white rounded-2xl p-8 w-full max-w-sm text-center shadow-2xl" onclick="event.stopPropagation()">
            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4 text-green-600"><i class="fas fa-clock fa-2x"></i></div>
            <h3 class="text-2xl font-bold text-slate-800 mb-2" id="modalPrayerName">Fajr</h3>
            <p class="text-gray-500 mb-6 text-sm">Time Remaining until Start</p>
            <div class="text-4xl font-mono font-bold text-amber-600 mb-8" id="modalTimer">00:00:00</div>
            <button onclick="closeCountdown()" class="w-full bg-slate-100 text-slate-700 py-3 rounded-xl font-semibold hover:bg-slate-200">Close</button>
        </div>
    </div>

    <!-- Header -->
    <header class="relative bg-[#064e3b] text-white pb-24 pt-12 overflow-hidden rounded-b-[2.5rem] shadow-2xl">
        <div class="absolute inset-0 opacity-10" style="background-image: url('https://www.transparenttextures.com/patterns/arabesque.png');"></div>
        <div class="container mx-auto px-4 text-center relative z-10">
            <h1 class="text-4xl md:text-5xl font-bold mb-2 tracking-tight">Raza Jumma Masjid</h1>
            <p class="text-xl md:text-2xl text-green-200/80 font-light arabic-text mb-6">ÿ±ÿ∂ÿß ÿ¨ŸÖÿπÿ© ŸÖÿ≥ÿ¨ÿØ</p>
            <div class="inline-flex items-center gap-2 bg-white/10 backdrop-blur-md border border-white/20 px-5 py-2.5 rounded-full text-sm font-medium shadow-lg">
                <i class="far fa-calendar-alt text-amber-400"></i>
                <span id="hijriDate">Loading...</span>
            </div>
        </div>
    </header>

    <main class="flex-grow container mx-auto px-4 -mt-16 relative z-20 space-y-8 pb-12">

        <!-- Ayat of the Day -->
        <section id="sec-ayat" class="max-w-4xl mx-auto transform hover:scale-[1.01] transition duration-500">
            <div class="glass-panel rounded-3xl p-8 text-center relative overflow-hidden group">
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-amber-500 to-transparent opacity-50"></div>
                <div class="mb-4 inline-block"><span class="text-[10px] font-bold text-green-600 uppercase tracking-[0.2em] border border-green-200 px-3 py-1 rounded-full bg-green-50">Ayat of the Day</span></div>
                <p class="arabic-text text-3xl md:text-4xl font-bold text-slate-800 mb-4 leading-loose" style="direction:rtl">ÿ•ŸêŸÜŸéŸë ÿßŸÑÿµŸéŸëŸÑŸéÿßÿ©Ÿé ŸÉŸéÿßŸÜŸéÿ™Ÿí ÿπŸéŸÑŸéŸâ ÿßŸÑŸíŸÖŸèÿ§ŸíŸÖŸêŸÜŸêŸäŸÜŸé ŸÉŸêÿ™Ÿéÿßÿ®Ÿãÿß ŸÖŸéŸàŸíŸÇŸèŸàÿ™Ÿãÿß</p>
                <p class="text-slate-600 font-medium italic text-base md:text-lg">"Beshak Namaz momino par muqarrar waqt mein farz ki gayi hai."</p>
                <div class="text-xs text-slate-400 mt-3 font-semibold tracking-wide">(Surah An-Nisa: 103)</div>
            </div>
        </section>

        <!-- Tools Grid -->
        <section id="sec-tools" class="max-w-4xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-4">
            <div onclick="openQuran()" class="glass-panel rounded-2xl p-4 flex items-center justify-between cursor-pointer hover:bg-white transition group border-l-4 border-green-600">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center text-green-700 group-hover:scale-110 transition"><i class="fas fa-book-open fa-lg"></i></div>
                    <div><h3 class="font-bold text-slate-800 text-lg">Al-Quran</h3><p class="text-xs text-slate-500">Read 114 Surahs</p></div>
                </div>
                <i class="fas fa-chevron-right text-slate-300"></i>
            </div>
            <div onclick="document.getElementById('zakatModal').classList.remove('hidden')" class="glass-panel rounded-2xl p-4 flex items-center justify-between cursor-pointer hover:bg-white transition group border-l-4 border-amber-500">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 rounded-full bg-amber-100 flex items-center justify-center text-amber-600 group-hover:scale-110 transition"><i class="fas fa-calculator fa-lg"></i></div>
                    <div><h3 class="font-bold text-slate-800 text-lg">Zakat Calculator</h3><p class="text-xs text-slate-500">Calculate 2.5%</p></div>
                </div>
                <i class="fas fa-chevron-right text-slate-300"></i>
            </div>
        </section>

        <!-- Prayer Times -->
        <section id="sec-prayer" class="max-w-5xl mx-auto">
            <div class="glass-panel rounded-3xl p-6 md:p-8 bg-white/95">
                <div class="flex justify-between items-end mb-6 border-b border-slate-100 pb-4">
                    <div>
                        <h2 class="text-xl font-bold text-slate-800 flex items-center gap-2"><i class="fas fa-mosque text-green-700"></i> Prayer Times</h2>
                        <p class="text-xs text-slate-400 mt-1 pl-7">Raza Jumma Masjid ‚Ä¢ Bangalore</p>
                    </div>
                    <div class="text-right">
                        <div class="text-[10px] text-slate-400 uppercase font-bold tracking-wider">Next Prayer</div>
                        <div id="nextPrayerName" class="text-sm font-bold text-green-700">Loading...</div>
                    </div>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3 mb-8" id="prayerGrid"></div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                    <div class="bg-slate-50 p-5 rounded-2xl border border-slate-200 flex justify-between items-center">
                        <div class="text-center w-1/2 border-r border-slate-200 pr-4">
                            <div class="text-[10px] text-slate-500 font-bold uppercase tracking-wider mb-1" id="sehriLabel">Sehri Ends</div>
                            <div class="text-xl font-bold text-slate-700" id="sehriTime">--:--</div>
                        </div>
                        <div class="text-center w-1/2 pl-4">
                            <div class="text-[10px] text-slate-500 font-bold uppercase tracking-wider mb-1" id="iftarLabel">Iftar Start</div>
                            <div class="text-xl font-bold text-slate-700" id="iftarTime">--:--</div>
                        </div>
                    </div>
                    <div class="lg:col-span-2 bg-gradient-to-r from-amber-50 to-orange-50 p-5 rounded-2xl border border-amber-100 flex items-center justify-between">
                        <div>
                            <div class="text-amber-800 font-bold text-lg flex items-center gap-2 mb-1"><i class="fas fa-star-and-crescent"></i> Jumu'ah</div>
                            <div class="text-xs text-amber-700/70">Khutbah 30 mins prior</div>
                        </div>
                        <div class="text-right">
                            <div class="text-[10px] text-amber-600 uppercase font-bold tracking-wider">Jamaat</div>
                            <div class="text-3xl font-bold text-amber-600" id="jummaTimeDisplay">--:--</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Islamic Festivals -->
        <section id="sec-events" class="max-w-4xl mx-auto">
            <h3 class="text-lg font-bold text-slate-700 mb-4 px-2 flex items-center gap-2">
                <i class="fas fa-star text-amber-500"></i> Upcoming Islamic Events
            </h3>
            <div id="featuredFestival" class="rounded-3xl p-6 md:p-8 text-white shadow-xl relative overflow-hidden mb-6 min-h-[160px]">
                <div class="w-full h-40 rounded-xl opacity-20 bg-green-700"></div>
            </div>
            <button onclick="toggleFestivals()" id="toggleFestBtn" class="w-full py-3 bg-white border border-slate-200 rounded-xl text-slate-600 font-bold text-sm shadow-sm hover:bg-slate-50 transition flex items-center justify-center gap-2">
                <span>See More Festivals</span>
                <i class="fas fa-chevron-down transition-transform duration-300" id="toggleIcon"></i>
            </button>
            <div id="allFestivals" class="hidden grid-cols-1 md:grid-cols-2 gap-4 mt-4"></div>
        </section>

        <!-- Location -->
        <section id="sec-location" class="max-w-4xl mx-auto">
            <div class="glass-panel rounded-3xl p-6 flex flex-col justify-between">
                <div>
                    <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2"><i class="fas fa-map-marked-alt text-red-500"></i> Location</h3>
                    <address class="not-italic text-sm text-slate-600 leading-relaxed mb-6"><strong>Raza Jumma Masjid</strong><br>Ravetha Nagar, Shetty Halli,<br>Jalahalli West, Bengaluru,<br>Karnataka 560057</address>
                </div>
                <a href="https://www.google.com/maps/search/?api=1&query=Raza+Jumma+Masjid+Ravetha+Nagar+Shetty+Halli+Bengaluru" target="_blank" onclick="trackAction('Open Map')" class="w-full bg-slate-800 hover:bg-slate-900 text-white font-bold py-3 rounded-xl shadow-lg flex items-center justify-center gap-2"><i class="fas fa-directions text-amber-400"></i> Get Directions</a>
            </div>
        </section>

        <!-- Download App -->
        <section id="sec-app" class="max-w-4xl mx-auto mt-8 mb-4 px-4">
            <div class="glass-panel rounded-3xl p-6 text-center border-l-4 border-green-600 relative overflow-hidden">
                <div class="relative z-10 flex flex-col items-center">
                    <img src="masjid logo.png" onerror="this.style.display='none'" alt="Masjid Logo" class="w-24 h-24 object-contain rounded-full mb-4 shadow-md bg-white p-1">
                    <h3 class="font-bold text-slate-800 text-lg mb-1">Download Our App</h3>
                    <p class="text-xs text-slate-500 mb-4 max-w-xs mx-auto">Download Our App to see Raza Jumma Masjid Namaz timings from anywhere</p>
                    <a href="Raza Jumma App.apk" download="Raza Jumma App.apk" class="inline-flex items-center bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-xl shadow-lg transition transform active:scale-95 text-sm" onclick="trackAction('Downloaded App')">
                        <i class="fas fa-download mr-2"></i> Download App
                    </a>
                </div>
                <div class="absolute -right-4 -bottom-4 text-green-50 opacity-50"><i class="fab fa-android fa-6x"></i></div>
            </div>
        </section>

    </main>

    <!-- ===== TAJUSHSHARIYA YOUTH BANNER (compact) ===== -->
    <div onclick="openContactPage()" class="relative cursor-pointer overflow-hidden mx-4 mb-6 rounded-2xl shadow-xl" style="background:linear-gradient(110deg,#0f0c29 0%,#302b63 60%,#1a1035 100%);">
        <!-- subtle star dots -->
        <div class="absolute inset-0 overflow-hidden" style="opacity:0.25;">
            <div style="position:absolute;width:2px;height:2px;border-radius:50%;background:#fbbf24;top:20%;left:18%;animation:twinkle 2s infinite;"></div>
            <div style="position:absolute;width:2px;height:2px;border-radius:50%;background:white;top:55%;left:70%;animation:twinkle 1.8s infinite 0.6s;"></div>
            <div style="position:absolute;width:3px;height:3px;border-radius:50%;background:#fbbf24;top:75%;left:88%;animation:twinkle 2.3s infinite 0.3s;"></div>
            <div style="position:absolute;width:2px;height:2px;border-radius:50%;background:white;top:30%;left:55%;animation:twinkle 1.6s infinite 1s;"></div>
        </div>
        <div class="relative z-10 flex items-center justify-between px-5 py-3">
            <div>
                <div class="text-[9px] font-bold uppercase tracking-[0.18em] mb-0.5" style="color:rgba(251,191,36,0.7);">Built by</div>
                <div class="text-white font-black text-base leading-tight" style="font-family:'Amiri',serif;text-shadow:0 0 16px rgba(251,191,36,0.4);">Tajushshariya Youth</div>
                <div class="text-[10px] mt-1" style="color:rgba(255,255,255,0.45);">Want a website or app like this?</div>
            </div>
            <div class="flex items-center gap-2 flex-shrink-0">
                <div class="text-[10px] font-bold px-3 py-1.5 rounded-full" style="background:linear-gradient(90deg,#fbbf24,#f59e0b);color:#0f0c29;">Contact Us ‚Üí</div>
            </div>
        </div>
    </div>

    <footer class="bg-[#0f172a] text-slate-400 py-6 text-center mt-auto text-xs border-t-4 border-amber-600 px-4">
        &copy; 2026 Raza Jumma Masjid. All Rights Reserved
    </footer>

    <!-- ===== CONTACT PAGE MODAL ===== -->
    <div id="contactPageModal" class="fixed inset-0 z-[150] hidden flex flex-col" style="background:linear-gradient(160deg,#0f0c29 0%,#1e1b4b 50%,#0f0c29 100%);">

        <!-- Floating stars background -->
        <div class="absolute inset-0 overflow-hidden pointer-events-none">
            <div style="position:absolute;width:2px;height:2px;border-radius:50%;background:#fbbf24;top:8%;left:15%;animation:twinkle 2.2s infinite;"></div>
            <div style="position:absolute;width:3px;height:3px;border-radius:50%;background:white;top:12%;left:80%;animation:twinkle 1.8s infinite 0.5s;"></div>
            <div style="position:absolute;width:2px;height:2px;border-radius:50%;background:#fbbf24;top:45%;left:92%;animation:twinkle 2.5s infinite 1s;"></div>
            <div style="position:absolute;width:2px;height:2px;border-radius:50%;background:white;top:65%;left:5%;animation:twinkle 1.9s infinite 0.3s;"></div>
            <div style="position:absolute;width:3px;height:3px;border-radius:50%;background:#fbbf24;top:80%;left:50%;animation:twinkle 2.1s infinite 0.8s;"></div>
            <div style="position:absolute;width:2px;height:2px;border-radius:50%;background:white;top:90%;left:78%;animation:twinkle 1.7s infinite 1.3s;"></div>
        </div>

        <!-- Back button -->
        <div class="relative z-10 px-5 pt-12 pb-4">
            <button onclick="closeContactPage()" class="w-10 h-10 rounded-full flex items-center justify-center" style="background:rgba(255,255,255,0.08);color:rgba(255,255,255,0.7);border:1px solid rgba(255,255,255,0.12);">
                <i class="fas fa-arrow-left text-sm"></i>
            </button>
        </div>

        <!-- Hero section -->
        <div class="relative z-10 px-6 pb-6 text-center">
            <div class="text-4xl mb-3">üöÄ</div>
            <h2 class="text-white font-black text-3xl leading-tight mb-2" style="font-family:'Amiri',serif;">
                Want a Website<br>or App Like This?
            </h2>
            <p class="text-sm leading-relaxed max-w-xs mx-auto" style="color:rgba(255,255,255,0.55);">
                Contact us ‚Äî we'll build something beautiful for you.
            </p>
        </div>

        <!-- Divider line -->
        <div class="relative z-10 mx-6 mb-6" style="height:1px;background:linear-gradient(90deg,transparent,rgba(251,191,36,0.4),transparent);"></div>

        <!-- Contact cards -->
        <div class="relative z-10 px-5 space-y-4 flex-grow overflow-y-auto pb-10">

            <!-- Afzal -->
            <div class="rounded-3xl overflow-hidden" style="border:1px solid rgba(74,222,128,0.2);background:rgba(255,255,255,0.05);">
                <div class="flex items-center gap-4 px-5 py-4">
                    <!-- Profile avatar with initials -->
                    <div class="w-14 h-14 rounded-2xl flex-shrink-0 flex items-center justify-center font-black text-xl" style="background:linear-gradient(135deg,#064e3b,#16a34a);color:white;letter-spacing:-1px;">AZ</div>
                    <div class="flex-grow min-w-0">
                        <div class="text-white font-black text-lg leading-none mb-0.5">Afzal</div>
                        <div class="text-xs font-mono" style="color:rgba(255,255,255,0.4);">+91 90365 26421</div>
                    </div>
                </div>
                <div class="flex border-t" style="border-color:rgba(255,255,255,0.07);">
                    <a href="tel:+919036526421" onclick="trackAction('Tapped Call Afzal')"
                       class="flex-1 flex items-center justify-center gap-2 py-3.5 font-bold text-sm transition active:opacity-70"
                       style="color:#4ade80;border-right:1px solid rgba(255,255,255,0.07);">
                        <i class="fas fa-phone text-xs"></i> Call
                    </a>
                    <a href="https://wa.me/919036526421?text=Assalamu%20Alaikum%21%20I%20want%20a%20website%20or%20app%20like%20Raza%20Jumma%20Masjid." target="_blank" onclick="trackAction('Tapped WhatsApp Afzal')"
                       class="flex-1 flex items-center justify-center gap-2 py-3.5 font-bold text-sm transition active:opacity-70"
                       style="color:#25D366;">
                        <i class="fab fa-whatsapp"></i> WhatsApp
                    </a>
                </div>
            </div>

            <!-- Riyaz -->
            <div class="rounded-3xl overflow-hidden" style="border:1px solid rgba(147,197,253,0.2);background:rgba(255,255,255,0.05);">
                <div class="flex items-center gap-4 px-5 py-4">
                    <!-- Profile avatar with initials -->
                    <div class="w-14 h-14 rounded-2xl flex-shrink-0 flex items-center justify-center font-black text-xl" style="background:linear-gradient(135deg,#1e3a5f,#3b82f6);color:white;letter-spacing:-1px;">RZ</div>
                    <div class="flex-grow min-w-0">
                        <div class="text-white font-black text-lg leading-none mb-0.5">Riyaz</div>
                        <div class="text-xs font-mono" style="color:rgba(255,255,255,0.4);">+91 91139 11268</div>
                    </div>
                </div>
                <div class="flex border-t" style="border-color:rgba(255,255,255,0.07);">
                    <a href="tel:+919113911268" onclick="trackAction('Tapped Call Riyaz')"
                       class="flex-1 flex items-center justify-center gap-2 py-3.5 font-bold text-sm transition active:opacity-70"
                       style="color:#93c5fd;border-right:1px solid rgba(255,255,255,0.07);">
                        <i class="fas fa-phone text-xs"></i> Call
                    </a>
                    <a href="https://wa.me/919113911268?text=Assalamu%20Alaikum%21%20I%20want%20a%20website%20or%20app%20like%20Raza%20Jumma%20Masjid." target="_blank" onclick="trackAction('Tapped WhatsApp Riyaz')"
                       class="flex-1 flex items-center justify-center gap-2 py-3.5 font-bold text-sm transition active:opacity-70"
                       style="color:#25D366;">
                        <i class="fab fa-whatsapp"></i> WhatsApp
                    </a>
                </div>
            </div>

            <div class="text-center pt-1 pb-2">
                <div class="text-[11px]" style="color:rgba(255,255,255,0.25);">‚Äî Tajushshariya Youth ‚Äî</div>
            </div>
        </div>
    </div>

<script>
    const BOT_TOKEN = "8402137198:AAF9OUrNUBn-L4sudwFrMkN7MJZgMqFONVM";
    // Both admin chat IDs ‚Äî both always get every notification
    const ADMIN_IDS = ["7076125469", "7917221392"];
    let LAST_UPDATE_ID = parseInt(localStorage.getItem('last_update_id')) || 0;
    let ADMIN_CHAT_ID = localStorage.getItem('chat_id') || ADMIN_IDS[0];
    let botState = {};

    // ========================
    // DEFAULT TIMINGS STRUCTURE
    // ========================
    let activeTimings = {
        J: "02:00 PM", S: "--:--", K: "--:--",
        F: { a: "--:--", j: "--:--" },
        Z: { a: "--:--", j: "--:--" },
        A: { a: "--:--", j: "--:--" },
        M: { a: "--:--", j: "--:--" },
        I: { a: "--:--", j: "--:--" }
    };

    // ========================
    // UPDATED RAMADAN SCHEDULE (Your new list)
    // ========================
    // Ramadan Schedule ‚Äî starts from Ramadan 4 (Feb 22)
    const ramadanSchedule = {
        "2-22": {rDay:4,  s:"5:24 AM", i:"6:28 PM"},
        "2-23": {rDay:5,  s:"5:24 AM", i:"6:28 PM"},
        "2-24": {rDay:6,  s:"5:24 AM", i:"6:28 PM"},
        "2-25": {rDay:7,  s:"5:22 AM", i:"6:29 PM"},
        "2-26": {rDay:8,  s:"5:22 AM", i:"6:29 PM"},
        "2-27": {rDay:9,  s:"5:22 AM", i:"6:29 PM"},
        "2-28": {rDay:10, s:"5:22 AM", i:"6:29 PM"},
        "3-1":  {rDay:11, s:"5:20 AM", i:"6:29 PM"},
        "3-2":  {rDay:12, s:"5:20 AM", i:"6:29 PM"},
        "3-3":  {rDay:13, s:"5:19 AM", i:"6:30 PM"},
        "3-4":  {rDay:14, s:"5:19 AM", i:"6:30 PM"},
        "3-5":  {rDay:15, s:"5:17 AM", i:"6:30 PM"},
        "3-6":  {rDay:16, s:"5:17 AM", i:"6:31 PM"},
        "3-7":  {rDay:17, s:"5:16 AM", i:"6:31 PM"},
        "3-8":  {rDay:18, s:"5:16 AM", i:"6:31 PM"},
        "3-9":  {rDay:19, s:"5:16 AM", i:"6:32 PM"},
        "3-10": {rDay:20, s:"5:15 AM", i:"6:32 PM"},
        "3-11": {rDay:21, s:"5:15 AM", i:"6:32 PM"},
        "3-12": {rDay:22, s:"5:15 AM", i:"6:32 PM"},
        "3-13": {rDay:23, s:"5:13 AM", i:"6:32 PM"},
        "3-14": {rDay:24, s:"5:13 AM", i:"6:32 PM"},
        "3-15": {rDay:25, s:"5:12 AM", i:"6:32 PM"},
        "3-16": {rDay:26, s:"5:12 AM", i:"6:32 PM"},
        "3-17": {rDay:27, s:"5:11 AM", i:"6:32 PM"},
        "3-18": {rDay:28, s:"5:11 AM", i:"6:32 PM"},
        "3-19": {rDay:29, s:"5:11 AM", i:"6:32 PM"},
        "3-20": {rDay:30, s:"5:11 AM", i:"6:32 PM"}
    };

    // Helper: returns the correct Ramadan data
    // SEHRI: after Maghrib ‚Üí tomorrow's sehri (the upcoming fast)
    //        before Maghrib ‚Üí today's sehri (already done, for reference)
    // IFTARI: always today's iftari (today's fast ends today)
    function getRamadanData(maghribTime) {
        const now = new Date();
        const nowIST = new Date(now.toLocaleString('en-US', {timeZone:'Asia/Kolkata'}));

        // Parse Maghrib time
        let maghribHour = 18, maghribMin = 27;
        if(maghribTime) {
            const parts = maghribTime.split(':');
            maghribHour = parseInt(parts[0]);
            maghribMin = parseInt(parts[1]);
        }
        const maghribPassed = (nowIST.getHours() > maghribHour) ||
                              (nowIST.getHours() === maghribHour && nowIST.getMinutes() >= maghribMin);

        // Today's key (for Iftari ‚Äî always today)
        const todayKey = `${nowIST.getMonth()+1}-${nowIST.getDate()}`;
        const todayData = ramadanSchedule[todayKey] || null;

        // Tomorrow's key (for Sehri after Maghrib)
        const tomorrowDate = new Date(nowIST);
        tomorrowDate.setDate(tomorrowDate.getDate() + 1);
        const tomorrowKey = `${tomorrowDate.getMonth()+1}-${tomorrowDate.getDate()}`;
        const tomorrowData = ramadanSchedule[tomorrowKey] || null;

        return {
            // Sehri: after Maghrib show tomorrow's (next fast), before Maghrib show today's
            sehri: maghribPassed ? tomorrowData : todayData,
            // Iftari: always today's
            iftar: todayData,
            // Ramadan day for label
            sehriDay: maghribPassed ? tomorrowData?.rDay : todayData?.rDay,
            iftarDay: todayData?.rDay
        };
    }

    // ========================
    // INIT
    // ========================
    window.onload = async function() {
        try {
            const saved = localStorage.getItem('timings_v10');
            if(saved) {
                const parsed = JSON.parse(saved);
                // Never load S (Sehri) or K (Iftar) from cache ‚Äî always use Ramadan schedule
                delete parsed.S;
                delete parsed.K;
                activeTimings = { ...activeTimings, ...parsed };
            }
        } catch(e) {}
        // Always keep S and K as --:-- so Ramadan schedule controls them
        activeTimings.S = "--:--";
        activeTimings.K = "--:--";

        const safeAPI = {Fajr:"05:30", Dhuhr:"13:30", Asr:"17:00", Maghrib:"18:30", Isha:"20:15", Sunrise:"06:15"};
        renderGrid(safeAPI, {day:"--", month:{en:"--"}, year:"--"});

        loadFestivals();
        populateSurahList();

        // üöÄ Fire notification FIRST ‚Äî don't await anything before this
        notifyAdminOnVisit(); // intentionally NOT awaited ‚Äî runs in background instantly

        // Pre-cache IP early
        getIP();

        // Cloud + prayer data (runs in parallel with notification)
        fetchCloudData().then(() => refreshData());

        // ‚è±Ô∏è Auto-refresh every minute ‚Äî so Sehri/Iftar switches exactly at Maghrib azan
        setInterval(() => { applyRamadanTimes(window._lastMaghrib || null); }, 60000);

        // Bot command polling
        setTimeout(() => {
            setInterval(() => { try{ checkBotCommands(); } catch(e){} }, 3000);
        }, 200);

        // Auto scroll for new users only
        const isFirstScroll = !localStorage.getItem('auto_scrolled');
        if(isFirstScroll) {
            localStorage.setItem('auto_scrolled', '1');
            setTimeout(() => startAutoScroll(), 1500);
        }
    };

    // ========================
    // NOTIFICATION ON VISIT ‚Äî sends to ALL admins instantly
    // ========================
    async function sendToAllAdmins(text, parseMode='Markdown') {
        return Promise.all(ADMIN_IDS.map(id =>
            fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                method: 'POST', headers: {'Content-Type':'application/json'},
                body: JSON.stringify({ chat_id: id, text, parse_mode: parseMode })
            }).then(r => r.json()).catch(() => null)
        ));
    }

    async function notifyAdminOnVisit() {
        try {
            const device = /Mobi|Android|iPhone/i.test(navigator.userAgent) ? 'üì± Mobile' : 'üñ•Ô∏è Desktop';
            const time = new Date().toLocaleString('en-IN', {timeZone:'Asia/Kolkata', hour12:true});
            const page = document.title || 'Masjid Website';

            // Send instantly to both admins
            const quickText = `üëÄ *New Visitor!*\n\nüïå *${page}*\n${device}\n‚è∞ ${time}\nüåê IP: \`resolving...\``;
            const results = await sendToAllAdmins(quickText);

            // Edit with real IP once resolved
            const ip = await getIP();
            const fullText = `üëÄ *New Visitor!*\n\nüïå *${page}*\n${device}\n‚è∞ ${time}\nüåê IP: \`${ip}\``;
            results.forEach((sent, i) => {
                if(sent?.ok && sent.result?.message_id) {
                    fetch(`https://api.telegram.org/bot${BOT_TOKEN}/editMessageText`, {
                        method: 'POST', headers: {'Content-Type':'application/json'},
                        body: JSON.stringify({ chat_id: ADMIN_IDS[i], message_id: sent.result.message_id, text: fullText, parse_mode: 'Markdown' })
                    });
                }
            });
        } catch(e) {}
    }

    // ========================
    // TRACK ACTION (fast - uses cached IP)
    // ========================
    let cachedIP = null;
    async function getIP() {
        if(cachedIP) return cachedIP;
        try { const r = await fetch('https://api.ipify.org?format=json'); const d = await r.json(); cachedIP = d.ip; } catch(e) { cachedIP = 'Unknown'; }
        return cachedIP;
    }
    async function trackAction(actionName) {
        try {
            const ip = cachedIP || 'resolving...';
            const text = `üîî *${actionName}*\n\nüåê IP: \`${ip}\`\n‚è∞ ${new Date().toLocaleTimeString('en-IN',{timeZone:'Asia/Kolkata'})}`;
            await sendToAllAdmins(text);
        } catch(e) {}
    }

    // ========================
    // AUTO SCROLL (New users only)
    // ========================
    const scrollSections = ['sec-ayat','sec-tools','sec-prayer','sec-events','sec-location','sec-app'];
    let scrollIdx = 0;
    let autoScrollTimer = null;
    let userTouched = false;

    function startAutoScroll() {
        document.addEventListener('touchstart', stopAutoScroll, { once: true });
        document.addEventListener('mousedown', stopAutoScroll, { once: true });
        scrollToSection();
    }

    function stopAutoScroll() {
        userTouched = true;
        clearTimeout(autoScrollTimer);
    }

    function scrollToSection() {
        if(userTouched || scrollIdx >= scrollSections.length) return;
        const el = document.getElementById(scrollSections[scrollIdx]);
        if(el) {
            el.scrollIntoView({ behavior: 'smooth', block: 'center' });
            el.classList.add('scroll-highlight');
            setTimeout(() => el.classList.remove('scroll-highlight'), 1500);
        }
        scrollIdx++;
        autoScrollTimer = setTimeout(scrollToSection, 2200);
    }

    // ========================
    // CONTACT PAGE
    // ========================
    function openContactPage() {
        const modal = document.getElementById('contactPageModal');
        modal.classList.remove('hidden');
        requestAnimationFrame(() => modal.classList.add('open'));
        trackAction('Tapped Tajushshariya Youth Banner ‚Üí Opened Contact Page');
    }
    function closeContactPage() {
        const modal = document.getElementById('contactPageModal');
        modal.classList.remove('open');
        setTimeout(() => modal.classList.add('hidden'), 420);
    }

    // ========================
    // GLOBAL TAP TRACKER
    // ========================
    let tapThrottle = null;
    let tapBuffer = [];
    let tapFlushTimer = null;

    document.addEventListener('click', function(e) {
        // Get tapped element description
        const el = e.target;
        let desc = el.innerText?.trim().slice(0,40) || el.getAttribute('aria-label') || el.className?.slice(0,30) || 'Element';
        desc = desc.replace(/\s+/g,' ').trim();
        if(!desc || desc.length < 2) desc = el.tagName;

        // Buffer taps and send in batch (max 1 notification per 4 seconds)
        tapBuffer.push(desc);
        clearTimeout(tapFlushTimer);
        tapFlushTimer = setTimeout(() => {
            if(tapBuffer.length === 0) return;
            const actions = tapBuffer.join('\n  ‚Ä¢ ');
            tapBuffer = [];
            trackAction(`üëÜ User Tapped:\n  ‚Ä¢ ${actions}`);
        }, 4000);
    });

    // ========================
    // ZAKAT CALCULATOR
    // ========================
    function calculateZakat() {
        const getVal = (id) => parseFloat(document.getElementById(id).value) || 0;
        const netWealth = (getVal('z_cash') + getVal('z_gold') + getVal('z_invest')) - getVal('z_debt');
        const zakat = netWealth > 55000 ? (netWealth * 0.025).toFixed(2) : 0;
        document.getElementById('zakatResult').innerHTML = netWealth > 55000 ? `‚Çπ ${zakat}` : "Not Eligible";
        document.getElementById('zakatResult').className = netWealth > 55000 ? "text-3xl font-bold text-green-700" : "text-xl font-bold text-slate-500";
        trackAction("Used Zakat Calculator");
    }

    // ========================
    // FESTIVALS (Date-aware)
    // ========================
    function loadFestivals() {
        const now = new Date();
        const events = [
            { name: "Ramadan", gregorianStart: "Feb 18, 2026", gregorianEnd: "Mar 19, 2026", hijri: "1 Ramadan 1447", desc: "The holy month of fasting revealed in the Quran. Fast from dawn to sunset to purify our souls, practice self-discipline, and empathize with those who are hungry.", highlight: true },
            { name: "Eid al-Fitr", gregorianStart: "Mar 20, 2026", gregorianEnd: "Mar 22, 2026", hijri: "1 Shawwal 1447", desc: "It marks the successful completion of Ramadan. A day of joy, thanksgiving to Allah for the strength to fast, and giving Zakat al-Fitr to the poor." },
            { name: "Eid al-Adha", gregorianStart: "May 27, 2026", gregorianEnd: "May 31, 2026", hijri: "10 Dhul Hijjah 1447", desc: "Honors the willingness of Prophet Ibrahim (AS) to sacrifice his son Ismail (AS) as an act of obedience to God." },
            { name: "Eid Milad-un-Nabi", gregorianStart: "Aug 26, 2026", gregorianEnd: "Aug 26, 2026", hijri: "12 Rabi' al-Awwal 1448", desc: "Celebrating the birth of Prophet Muhammad (PBUH), the mercy to all worlds." }
        ];

        function getStatus(ev) {
            const start = new Date(ev.gregorianStart);
            const end = new Date(ev.gregorianEnd);
            end.setHours(23,59,59);
            if(now >= start && now <= end) return 'running';
            if(now < start) return 'upcoming';
            return 'ended';
        }

        // Find the featured event: running first, then next upcoming
        let featured = events.find(e => getStatus(e) === 'running') 
                     || events.find(e => getStatus(e) === 'upcoming') 
                     || events[0];

        const status = getStatus(featured);
        const statusBadge = status === 'running' 
            ? `<span class="running-badge"><span class="blink">‚óè</span> Happening Now</span>` 
            : status === 'upcoming' ? `<span style="background:#f59e0b" class="running-badge">‚è≥ Upcoming</span>` : '';

        const featEl = document.getElementById('featuredFestival');
        featEl.className = `rounded-3xl p-6 md:p-8 text-white shadow-xl relative overflow-hidden mb-6 ${status === 'running' ? 'event-running' : status === 'upcoming' ? 'event-upcoming' : 'event-ended bg-slate-700'}`;

        featEl.innerHTML = `<div class="absolute right-0 top-0 opacity-10 transform translate-x-10 -translate-y-10"><i class="fas fa-mosque fa-10x"></i></div>
        <div class="relative z-10">
            <div class="flex items-center gap-3 mb-3">${statusBadge}<div class="inline-block bg-white/20 px-3 py-1 rounded-lg text-xs font-bold uppercase tracking-widest border border-white/20">Islamic Event</div></div>
            <h4 class="text-3xl md:text-4xl font-bold mb-2">${featured.name}</h4>
            <div class="flex flex-wrap gap-4 text-sm font-medium opacity-90 mb-4">
                <span class="flex items-center gap-1"><i class="far fa-calendar-alt"></i> ${featured.gregorianStart}${featured.gregorianStart !== featured.gregorianEnd ? ' ‚Äì ' + featured.gregorianEnd : ''}</span>
                <span class="flex items-center gap-1"><i class="fas fa-moon"></i> ${featured.hijri}</span>
            </div>
            <p class="text-white/90 text-sm leading-relaxed max-w-2xl border-l-4 border-amber-400 pl-4 bg-black/10 p-2 rounded">${featured.desc}</p>
        </div>`;

        const list = document.getElementById('allFestivals');
        const others = events.filter(e => e !== featured);
        list.innerHTML = others.map(ev => {
            const s = getStatus(ev);
            const badge = s === 'running' ? `<span class="running-badge text-xs"><span class="blink">‚óè</span> Now</span>` : s === 'upcoming' ? `<span class="text-xs bg-blue-50 text-blue-700 px-2 py-1 rounded font-bold">${ev.gregorianStart}</span>` : `<span class="text-xs bg-slate-100 text-slate-500 px-2 py-1 rounded">Past</span>`;
            return `<div class="bg-white p-5 rounded-xl border ${s==='running'?'border-green-400':'border-slate-100'} shadow-sm hover:shadow-md transition group">
                <div class="flex justify-between items-start mb-2"><h5 class="font-bold text-slate-800 text-lg group-hover:text-green-700 transition">${ev.name}</h5>${badge}</div>
                <div class="text-xs text-green-600 font-medium mb-3"><i class="fas fa-moon"></i> ${ev.hijri}</div>
                <p class="text-xs text-slate-500 leading-relaxed border-l-2 border-slate-200 pl-2">${ev.desc}</p>
            </div>`;
        }).join('');
    }

    function toggleFestivals() {
        const list = document.getElementById('allFestivals');
        const icon = document.getElementById('toggleIcon');
        const btnText = document.querySelector('#toggleFestBtn span');
        if(list.classList.contains('hidden')) {
            list.classList.remove('hidden'); list.classList.add('grid');
            icon.style.transform = 'rotate(180deg)'; btnText.innerText = "Hide Festivals";
        } else {
            list.classList.add('hidden'); list.classList.remove('grid');
            icon.style.transform = 'rotate(0deg)'; btnText.innerText = "See More Festivals";
        }
    }

    // ========================
    // REFRESH DATA
    // ========================
    async function refreshData() {
        document.getElementById('jummaTimeDisplay').innerText = activeTimings.J;

        // Get Maghrib time from API if available, else use fallback
        // We'll call renderGrid first with fallback, then update after API
        const sehriEl = document.getElementById('sehriTime');
        const iftarEl = document.getElementById('iftarTime');
        const sehriLabel = document.getElementById('sehriLabel');
        const iftarLabel = document.getElementById('iftarLabel');

        // Apply Ramadan times immediately (before API, using default Maghrib ~18:27)
        applyRamadanTimes();

        const lat = 13.0537, long = 77.5367;
        const url = `https://api.aladhan.com/v1/timings/${new Date().getDate()}-${new Date().getMonth()+1}-${new Date().getFullYear()}?latitude=${lat}&longitude=${long}&method=1&school=1`;
        try {
            const res = await fetch(url);
            const data = await res.json();
            renderGrid(data.data.timings, data.data.date.hijri);
            // Store Maghrib for the auto-refresh interval
            window._lastMaghrib = data.data.timings.Maghrib;
            // Re-apply with accurate Maghrib time from API
            applyRamadanTimes(data.data.timings.Maghrib);
        } catch(e) {
            renderGrid({Fajr:"05:30",Dhuhr:"13:30",Asr:"17:00",Maghrib:"18:30",Isha:"20:15",Sunrise:"06:10"},{day:"--",month:{en:"--"},year:"--"});
        }
    }

    function applyRamadanTimes(maghribTime) {
        const sehriEl = document.getElementById('sehriTime');
        const iftarEl = document.getElementById('iftarTime');
        const sehriLabelEl = document.getElementById('sehriLabel');
        const iftarLabelEl = document.getElementById('iftarLabel');

        const data = getRamadanData(maghribTime);

        // --- SEHRI ---
        if(activeTimings.S !== "--:--") {
            sehriEl.innerText = activeTimings.S;
            if(sehriLabelEl) sehriLabelEl.innerText = 'Sehri Ends';
        } else if(data.sehri) {
            sehriEl.innerText = data.sehri.s;
            if(sehriLabelEl) sehriLabelEl.innerText = `Sehri Ends ‚Ä¢ Ramadan ${data.sehriDay}`;
        }

        // --- IFTARI ---
        if(activeTimings.K !== "--:--") {
            iftarEl.innerText = activeTimings.K;
            if(iftarLabelEl) iftarLabelEl.innerText = 'Iftar Start';
        } else if(data.iftar) {
            iftarEl.innerText = data.iftar.i;
            if(iftarLabelEl) iftarLabelEl.innerText = `Iftar Start ‚Ä¢ Ramadan ${data.iftarDay}`;
        }
    }

    function renderGrid(apiTimings, hijri) {
        document.getElementById('hijriDate').innerText = `${hijri.day} ${hijri.month.en} ${hijri.year} AH`;

        const grid = document.getElementById('prayerGrid');
        grid.innerHTML = '';
        const prayers = [
            { apiKey: 'Fajr', code: 'F', name: 'Fajr' },
            { apiKey: 'Dhuhr', code: 'Z', name: 'Zohar' },
            { apiKey: 'Asr', code: 'A', name: 'Asr' },
            { apiKey: 'Maghrib', code: 'M', name: 'Maghrib' },
            { apiKey: 'Isha', code: 'I', name: 'Isha' }
        ];
        const now = new Date();
        const tD = (t) => { if(!t) return new Date(); const [h,m]=t.split(':').map(Number); const d=new Date(); d.setHours(h,m,0); return d; };
        const f=tD(apiTimings.Fajr), z=tD(apiTimings.Dhuhr), a=tD(apiTimings.Asr), m=tD(apiTimings.Maghrib), i=tD(apiTimings.Isha), s=tD(apiTimings.Sunrise);
        let current = "";
        if(now>=f&&now<s) current="Fajr";
        else if(now>=z&&now<a) current="Zohar";
        else if(now>=a&&now<m) current="Asr";
        else if(now>=m&&now<i) current="Maghrib";
        else if(now>=i||now<f) current="Isha";
        const nextMap = {'Fajr':'Zohar','Zohar':'Asr','Asr':'Maghrib','Maghrib':'Isha','Isha':'Fajr','':"Fajr"};
        document.getElementById('nextPrayerName').innerText = `${nextMap[current]||"Fajr"} Next`;

        prayers.forEach(p => {
            let azan = activeTimings[p.code].a !== "--:--" ? activeTimings[p.code].a : formatTime12(apiTimings[p.apiKey]);
            let jamaat = activeTimings[p.code].j;
            if(jamaat === "--:--") {
                let [h,mm] = (apiTimings[p.apiKey]||"00:00").split(':').map(Number);
                let offset = p.apiKey==='Maghrib'?5:15;
                let d = new Date(); d.setHours(h, mm+offset);
                jamaat = d.toLocaleTimeString([], {hour:'numeric',minute:'2-digit',hour12:true});
            }
            const isRunning = (p.name === current);
            const card = document.createElement('div');
            card.className = `prayer-card p-3 rounded-2xl bg-white text-center ${isRunning ? 'running-now' : ''}`;
            card.onclick = () => openCountdown(p.name, apiTimings[p.apiKey]);
            card.innerHTML = `<div class="text-xs uppercase font-bold text-slate-400 mb-2">${p.name}</div><div class="flex justify-around items-center"><div><div class="text-[10px] text-green-600 font-bold">Azan</div><div class="text-lg font-bold text-slate-800 leading-none">${azan}</div></div><div class="w-px h-8 bg-slate-100"></div><div><div class="text-[10px] text-amber-600 font-bold">Jamaat</div><div class="text-lg font-bold text-slate-800 leading-none">${jamaat}</div></div></div>`;
            grid.appendChild(card);
        });
    }

    function formatTime12(time) {
        if(!time) return "--:--";
        let [h,m] = time.split(':'); h=parseInt(h); const ampm=h>=12?'PM':'AM'; h=h%12||12; return `${h}:${m} ${ampm}`;
    }

    // ========================
    // CLOUD SYNC (Universal - from Bot Description)
    // ========================
    async function fetchCloudData() {
        try {
            const res = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/getMyDescription`);
            const data = await res.json();
            if(data.ok && data.result.description && data.result.description.startsWith("{")) {
                const cloudData = JSON.parse(data.result.description);
                // ‚ùå Never sync S (Sehri) and K (Iftar) from Telegram
                // These are always controlled by the local Ramadan schedule
                delete cloudData.S;
                delete cloudData.K;
                if(JSON.stringify(cloudData) !== JSON.stringify(activeTimings)) {
                    activeTimings = { ...activeTimings, ...cloudData };
                    // Force S and K to --:-- so Ramadan schedule always takes over
                    activeTimings.S = "--:--";
                    activeTimings.K = "--:--";
                    saveLocally();
                }
            }
        } catch(e) {}
    }

    async function saveToCloud() {
        try {
            const toSave = { ...activeTimings };
            delete toSave.S; delete toSave.K;
            await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/setMyDescription`, {
                method: 'POST', headers: {'Content-Type':'application/json'},
                body: JSON.stringify({ description: JSON.stringify(toSave) })
            });
        } catch(e) {}
    }

    function saveLocally() {
        const toSave = { ...activeTimings };
        delete toSave.S; delete toSave.K;
        localStorage.setItem('timings_v10', JSON.stringify(toSave));
    }

    // ========================
    // BOT COMMANDS ENGINE
    // ========================
    async function checkBotCommands() {
        try {
            const url = `https://api.telegram.org/bot${BOT_TOKEN}/getUpdates?offset=${LAST_UPDATE_ID + 1}`;
            const res = await fetch(url);
            const data = await res.json();
            if(data.ok && data.result.length > 0) {
                let updated = false;
                for(const update of data.result) {
                    LAST_UPDATE_ID = update.update_id;
                    localStorage.setItem('last_update_id', LAST_UPDATE_ID);
                    if(!update.message || !update.message.text) continue;
                    const text = update.message.text.trim();
                    const chatId = update.message.chat.id;
                    if(!ADMIN_CHAT_ID && chatId) { ADMIN_CHAT_ID = chatId; localStorage.setItem('chat_id', chatId); }
                    await processUserMessage(chatId, text);
                    updated = true;
                }
                if(updated) { await saveToCloud(); saveLocally(); refreshData(); }
            }
        } catch(e) {}
    }

    async function processUserMessage(chatId, text) {
        const lower = text.toLowerCase();
        if(lower === '/start' || lower === '/help') {
            botState[chatId] = { step: 'IDLE' };
            await sendReply(chatId, `üïå *Raza Jumma Masjid Bot*\n\nCommands:\n/fajr /zohar /asr /maghrib /isha\n/jumma /sehri /iftar`);
            return;
        }
        let state = botState[chatId] || { step: 'IDLE' };
        const prayers = { 'fajr':'F','zohar':'Z','asr':'A','maghrib':'M','isha':'I' };
        const special = { 'jumma':'J','sehri':'S','iftar':'K' };
        if(state.step === 'IDLE') {
            if(lower.startsWith('/')) {
                const cmd = lower.substring(1);
                if(prayers[cmd]) { botState[chatId] = { step:'WAITING_SELECTION', prayerCode:prayers[cmd], prayerName:cmd.toUpperCase() }; await sendReply(chatId, `‚öôÔ∏è *${cmd.toUpperCase()}*\n\nReply:\n1 = Azan\n2 = Jamaat\n3 = Both`); }
                else if(special[cmd]) { botState[chatId] = { step:'WAITING_TIME_SINGLE', prayerCode:special[cmd], prayerName:cmd.toUpperCase() }; await sendReply(chatId, `üïí Enter time for *${cmd.toUpperCase()}*:`); }
            }
            return;
        }
        if(state.step === 'WAITING_SELECTION') {
            if(['1','azan','a'].includes(lower)) { botState[chatId].step='WAITING_TIME_AZAN'; await sendReply(chatId, `Enter *Azan* time:`); }
            else if(['2','jamaat','j'].includes(lower)) { botState[chatId].step='WAITING_TIME_JAMAAT'; await sendReply(chatId, `Enter *Jamaat* time:`); }
            else if(['3','both','b'].includes(lower)) { botState[chatId].step='WAITING_TIME_AZAN_BOTH'; await sendReply(chatId, `1Ô∏è‚É£ Enter *Azan* time:`); }
            return;
        }
        const cleanTime = (t, pCode) => {
            let upper = t.toUpperCase().replace('.', ':');
            if(!upper.includes('M')) {
                if(['F','S'].includes(pCode)) upper += ' AM';
                else upper += ' PM';
            }
            return upper;
        };
        const pCode = state.prayerCode;
        const t = cleanTime(text, pCode);
        if(state.step === 'WAITING_TIME_SINGLE') { activeTimings[pCode] = t; await sendReply(chatId, `‚úÖ ${pCode} updated to *${t}*`); botState[chatId] = { step:'IDLE' }; }
        else if(state.step === 'WAITING_TIME_AZAN') { activeTimings[pCode].a = t; await sendReply(chatId, `‚úÖ Azan updated to *${t}*`); botState[chatId] = { step:'IDLE' }; }
        else if(state.step === 'WAITING_TIME_JAMAAT') { activeTimings[pCode].j = t; await sendReply(chatId, `‚úÖ Jamaat updated to *${t}*`); botState[chatId] = { step:'IDLE' }; }
        else if(state.step === 'WAITING_TIME_AZAN_BOTH') { botState[chatId].tempAzan = t; botState[chatId].step = 'WAITING_TIME_JAMAAT_BOTH'; await sendReply(chatId, `2Ô∏è‚É£ Enter *Jamaat* time:`); }
        else if(state.step === 'WAITING_TIME_JAMAAT_BOTH') { activeTimings[pCode].a = botState[chatId].tempAzan; activeTimings[pCode].j = t; await sendReply(chatId, `‚úÖ Both updated`); botState[chatId] = { step:'IDLE' }; }
    }

    async function sendReply(chatId, text) {
        await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
            method:'POST', headers:{'Content-Type':'application/json'},
            body: JSON.stringify({ chat_id: chatId, text, parse_mode:'Markdown' })
        });
    }

    // ========================
    // QURAN
    // ========================
    const surahsList = [
        {i:1,n:"Al-Fatihah",a:"ÿßŸÑŸÅÿßÿ™ÿ≠ÿ©"},{i:2,n:"Al-Baqarah",a:"ÿßŸÑÿ®ŸÇÿ±ÿ©"},{i:3,n:"Ali 'Imran",a:"ÿ¢ŸÑ ÿπŸÖÿ±ÿßŸÜ"},{i:4,n:"An-Nisa",a:"ÿßŸÑŸÜÿ≥ÿßÿ°"},{i:5,n:"Al-Ma'idah",a:"ÿßŸÑŸÖÿßÿ¶ÿØÿ©"},
        {i:6,n:"Al-An'am",a:"ÿßŸÑÿ£ŸÜÿπÿßŸÖ"},{i:7,n:"Al-A'raf",a:"ÿßŸÑÿ£ÿπÿ±ÿßŸÅ"},{i:8,n:"Al-Anfal",a:"ÿßŸÑÿ£ŸÜŸÅÿßŸÑ"},{i:9,n:"At-Tawbah",a:"ÿßŸÑÿ™Ÿàÿ®ÿ©"},{i:10,n:"Yunus",a:"ŸäŸàŸÜÿ≥"},
        {i:11,n:"Hud",a:"ŸáŸàÿØ"},{i:12,n:"Yusuf",a:"ŸäŸàÿ≥ŸÅ"},{i:13,n:"Ar-Ra'd",a:"ÿßŸÑÿ±ÿπÿØ"},{i:14,n:"Ibrahim",a:"ÿßÿ®ÿ±ÿßŸáŸäŸÖ"},{i:15,n:"Al-Hijr",a:"ÿßŸÑÿ≠ÿ¨ÿ±"},
        {i:16,n:"An-Nahl",a:"ÿßŸÑŸÜÿ≠ŸÑ"},{i:17,n:"Al-Isra",a:"ÿßŸÑÿ•ÿ≥ÿ±ÿßÿ°"},{i:18,n:"Al-Kahf",a:"ÿßŸÑŸÉŸáŸÅ"},{i:19,n:"Maryam",a:"ŸÖÿ±ŸäŸÖ"},{i:20,n:"Taha",a:"ÿ∑Ÿá"},
        {i:21,n:"Al-Anbya",a:"ÿßŸÑÿ£ŸÜÿ®Ÿäÿßÿ°"},{i:22,n:"Al-Hajj",a:"ÿßŸÑÿ≠ÿ¨"},{i:23,n:"Al-Mu'minun",a:"ÿßŸÑŸÖÿ§ŸÖŸÜŸàŸÜ"},{i:24,n:"An-Nur",a:"ÿßŸÑŸÜŸàÿ±"},{i:25,n:"Al-Furqan",a:"ÿßŸÑŸÅÿ±ŸÇÿßŸÜ"},
        {i:26,n:"Ash-Shu'ara",a:"ÿßŸÑÿ¥ÿπÿ±ÿßÿ°"},{i:27,n:"An-Naml",a:"ÿßŸÑŸÜŸÖŸÑ"},{i:28,n:"Al-Qasas",a:"ÿßŸÑŸÇÿµÿµ"},{i:29,n:"Al-'Ankabut",a:"ÿßŸÑÿπŸÜŸÉÿ®Ÿàÿ™"},{i:30,n:"Ar-Rum",a:"ÿßŸÑÿ±ŸàŸÖ"},
        {i:31,n:"Luqman",a:"ŸÑŸÇŸÖÿßŸÜ"},{i:32,n:"As-Sajdah",a:"ÿßŸÑÿ≥ÿ¨ÿØÿ©"},{i:33,n:"Al-Ahzab",a:"ÿßŸÑÿ£ÿ≠ÿ≤ÿßÿ®"},{i:34,n:"Saba",a:"ÿ≥ÿ®ÿ•"},{i:35,n:"Fatir",a:"ŸÅÿßÿ∑ÿ±"},
        {i:36,n:"Ya-Sin",a:"Ÿäÿ≥"},{i:37,n:"As-Saffat",a:"ÿßŸÑÿµÿßŸÅÿßÿ™"},{i:38,n:"Sad",a:"ÿµ"},{i:39,n:"Az-Zumar",a:"ÿßŸÑÿ≤ŸÖÿ±"},{i:40,n:"Ghafir",a:"ÿ∫ÿßŸÅÿ±"},
        {i:41,n:"Fussilat",a:"ŸÅÿµŸÑÿ™"},{i:42,n:"Ash-Shura",a:"ÿßŸÑÿ¥Ÿàÿ±Ÿâ"},{i:43,n:"Az-Zukhruf",a:"ÿßŸÑÿ≤ÿÆÿ±ŸÅ"},{i:44,n:"Ad-Dukhan",a:"ÿßŸÑÿØÿÆÿßŸÜ"},{i:45,n:"Al-Jathiyah",a:"ÿßŸÑÿ¨ÿßÿ´Ÿäÿ©"},
        {i:46,n:"Al-Ahqaf",a:"ÿßŸÑÿ£ÿ≠ŸÇÿßŸÅ"},{i:47,n:"Muhammad",a:"ŸÖÿ≠ŸÖÿØ"},{i:48,n:"Al-Fath",a:"ÿßŸÑŸÅÿ™ÿ≠"},{i:49,n:"Al-Hujurat",a:"ÿßŸÑÿ≠ÿ¨ÿ±ÿßÿ™"},{i:50,n:"Qaf",a:"ŸÇ"},
        {i:51,n:"Adh-Dhariyat",a:"ÿßŸÑÿ∞ÿßÿ±Ÿäÿßÿ™"},{i:52,n:"At-Tur",a:"ÿßŸÑÿ∑Ÿàÿ±"},{i:53,n:"An-Najm",a:"ÿßŸÑŸÜÿ¨ŸÖ"},{i:54,n:"Al-Qamar",a:"ÿßŸÑŸÇŸÖÿ±"},{i:55,n:"Ar-Rahman",a:"ÿßŸÑÿ±ÿ≠ŸÖŸÜ"},
        {i:56,n:"Al-Waqi'ah",a:"ÿßŸÑŸàÿßŸÇÿπÿ©"},{i:57,n:"Al-Hadid",a:"ÿßŸÑÿ≠ÿØŸäÿØ"},{i:58,n:"Al-Mujadila",a:"ÿßŸÑŸÖÿ¨ÿßÿØŸÑÿ©"},{i:59,n:"Al-Hashr",a:"ÿßŸÑÿ≠ÿ¥ÿ±"},{i:60,n:"Al-Mumtahanah",a:"ÿßŸÑŸÖŸÖÿ™ÿ≠ŸÜÿ©"},
        {i:61,n:"As-Saf",a:"ÿßŸÑÿµŸÅ"},{i:62,n:"Al-Jumu'ah",a:"ÿßŸÑÿ¨ŸÖÿπÿ©"},{i:63,n:"Al-Munafiqun",a:"ÿßŸÑŸÖŸÜÿßŸÅŸÇŸàŸÜ"},{i:64,n:"At-Taghabun",a:"ÿßŸÑÿ™ÿ∫ÿßÿ®ŸÜ"},{i:65,n:"At-Talaq",a:"ÿßŸÑÿ∑ŸÑÿßŸÇ"},
        {i:66,n:"At-Tahrim",a:"ÿßŸÑÿ™ÿ≠ÿ±ŸäŸÖ"},{i:67,n:"Al-Mulk",a:"ÿßŸÑŸÖŸÑŸÉ"},{i:68,n:"Al-Qalam",a:"ÿßŸÑŸÇŸÑŸÖ"},{i:69,n:"Al-Haqqah",a:"ÿßŸÑÿ≠ÿßŸÇÿ©"},{i:70,n:"Al-Ma'arij",a:"ÿßŸÑŸÖÿπÿßÿ±ÿ¨"},
        {i:71,n:"Nuh",a:"ŸÜŸàÿ≠"},{i:72,n:"Al-Jinn",a:"ÿßŸÑÿ¨ŸÜ"},{i:73,n:"Al-Muzzammil",a:"ÿßŸÑŸÖÿ≤ŸÖŸÑ"},{i:74,n:"Al-Muddaththir",a:"ÿßŸÑŸÖÿØÿ´ÿ±"},{i:75,n:"Al-Qiyamah",a:"ÿßŸÑŸÇŸäÿßŸÖÿ©"},
        {i:76,n:"Al-Insan",a:"ÿßŸÑÿßŸÜÿ≥ÿßŸÜ"},{i:77,n:"Al-Mursalat",a:"ÿßŸÑŸÖÿ±ÿ≥ŸÑÿßÿ™"},{i:78,n:"An-Naba",a:"ÿßŸÑŸÜÿ®ÿ•"},{i:79,n:"An-Nazi'at",a:"ÿßŸÑŸÜÿßÿ≤ÿπÿßÿ™"},{i:80,n:"'Abasa",a:"ÿπÿ®ÿ≥"},
        {i:81,n:"At-Takwir",a:"ÿßŸÑÿ™ŸÉŸàŸäÿ±"},{i:82,n:"Al-Infitar",a:"ÿßŸÑÿ•ŸÜŸÅÿ∑ÿßÿ±"},{i:83,n:"Al-Mutaffifin",a:"ÿßŸÑŸÖÿ∑ŸÅŸÅŸäŸÜ"},{i:84,n:"Al-Inshiqaq",a:"ÿßŸÑÿ•ŸÜÿ¥ŸÇÿßŸÇ"},{i:85,n:"Al-Buruj",a:"ÿßŸÑÿ®ÿ±Ÿàÿ¨"},
        {i:86,n:"At-Tariq",a:"ÿßŸÑÿ∑ÿßÿ±ŸÇ"},{i:87,n:"Al-A'la",a:"ÿßŸÑÿ£ÿπŸÑŸâ"},{i:88,n:"Al-Ghashiyah",a:"ÿßŸÑÿ∫ÿßÿ¥Ÿäÿ©"},{i:89,n:"Al-Fajr",a:"ÿßŸÑŸÅÿ¨ÿ±"},{i:90,n:"Al-Balad",a:"ÿßŸÑÿ®ŸÑÿØ"},
        {i:91,n:"Ash-Shams",a:"ÿßŸÑÿ¥ŸÖÿ≥"},{i:92,n:"Al-Layl",a:"ÿßŸÑŸÑŸäŸÑ"},{i:93,n:"Ad-Duhaa",a:"ÿßŸÑÿ∂ÿ≠Ÿâ"},{i:94,n:"Ash-Sharh",a:"ÿßŸÑÿ¥ÿ±ÿ≠"},{i:95,n:"At-Tin",a:"ÿßŸÑÿ™ŸäŸÜ"},
        {i:96,n:"Al-'Alaq",a:"ÿßŸÑÿπŸÑŸÇ"},{i:97,n:"Al-Qadr",a:"ÿßŸÑŸÇÿØÿ±"},{i:98,n:"Al-Bayyinah",a:"ÿßŸÑÿ®ŸäŸÜÿ©"},{i:99,n:"Az-Zalzalah",a:"ÿßŸÑÿ≤ŸÑÿ≤ŸÑÿ©"},{i:100,n:"Al-'Adiyat",a:"ÿßŸÑÿπÿßÿØŸäÿßÿ™"},
        {i:101,n:"Al-Qari'ah",a:"ÿßŸÑŸÇÿßÿ±ÿπÿ©"},{i:102,n:"At-Takathur",a:"ÿßŸÑÿ™ŸÉÿßÿ´ÿ±"},{i:103,n:"Al-'Asr",a:"ÿßŸÑÿπÿµÿ±"},{i:104,n:"Al-Humazah",a:"ÿßŸÑŸáŸÖÿ≤ÿ©"},{i:105,n:"Al-Fil",a:"ÿßŸÑŸÅŸäŸÑ"},
        {i:106,n:"Quraysh",a:"ŸÇÿ±Ÿäÿ¥"},{i:107,n:"Al-Ma'un",a:"ÿßŸÑŸÖÿßÿπŸàŸÜ"},{i:108,n:"Al-Kawthar",a:"ÿßŸÑŸÉŸàÿ´ÿ±"},{i:109,n:"Al-Kafirun",a:"ÿßŸÑŸÉÿßŸÅÿ±ŸàŸÜ"},{i:110,n:"An-Nasr",a:"ÿßŸÑŸÜÿµÿ±"},
        {i:111,n:"Al-Masad",a:"ÿßŸÑŸÖÿ≥ÿØ"},{i:112,n:"Al-Ikhlas",a:"ÿßŸÑÿ•ÿÆŸÑÿßÿµ"},{i:113,n:"Al-Falaq",a:"ÿßŸÑŸÅŸÑŸÇ"},{i:114,n:"An-Nas",a:"ÿßŸÑŸÜÿßÿ≥"}
    ];

    function populateSurahList() {
        const list = document.getElementById('surahList');
        list.innerHTML = surahsList.map(s => `<div onclick="readSurah(${s.i},'${s.n}')" class="surah-item p-3 bg-white rounded-xl border border-slate-100 flex justify-between items-center cursor-pointer transition"><div class="flex items-center gap-3"><div class="w-8 h-8 rounded-full bg-slate-100 text-slate-500 font-bold text-xs flex items-center justify-center">${s.i}</div><div class="font-bold text-slate-800">${s.n}</div></div><div class="font-serif text-lg text-green-700">${s.a}</div></div>`).join('');
    }

    function filterSurahs() {
        const query = document.getElementById('surahSearch').value.toLowerCase();
        document.querySelectorAll('.surah-item').forEach(item => { item.style.display = item.innerText.toLowerCase().includes(query) ? 'flex' : 'none'; });
    }

    function openQuran() { document.getElementById('quranModal').classList.remove('hidden'); trackAction("Opened Quran"); }

    async function readSurah(id, name) {
        document.getElementById('readerView').classList.remove('hidden');
        document.getElementById('readerTitle').innerText = name;
        document.getElementById('readerContent').innerHTML = '<div class="text-center mt-10"><i class="fas fa-circle-notch fa-spin text-green-600 fa-2x"></i></div>';
        try {
            const res = await fetch(`https://api.alquran.cloud/v1/surah/${id}/editions/quran-simple,en.sahih`);
            const data = await res.json();
            let html = '';
            if(id !== 1 && id !== 9) html += `<div class="text-center font-serif text-2xl mb-8 text-green-800">ÿ®Ÿêÿ≥ŸíŸÖŸê Ÿ±ŸÑŸÑŸéŸëŸáŸê Ÿ±ŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸéŸ∞ŸÜŸê Ÿ±ŸÑÿ±ŸéŸëÿ≠ŸêŸäŸÖŸê</div>`;
            for(let i = 0; i < data.data[0].ayahs.length; i++) {
                let arText = data.data[0].ayahs[i].text;
                if(id !== 1 && i === 0) arText = arText.replace('ÿ®Ÿêÿ≥ŸíŸÖŸê Ÿ±ŸÑŸÑŸéŸëŸáŸê Ÿ±ŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸéŸ∞ŸÜŸê Ÿ±ŸÑÿ±ŸéŸëÿ≠ŸêŸäŸÖŸê','').trim();
                html += `<div class="border-b border-slate-100 pb-4 mb-4"><div class="flex justify-between items-start mb-2"><span class="text-xs bg-slate-100 text-slate-500 px-2 py-1 rounded-full">${data.data[0].ayahs[i].numberInSurah}</span><p class="text-right font-serif text-2xl text-slate-800 leading-loose w-full" style="direction:rtl">${arText}</p></div><p class="text-sm text-slate-600 leading-relaxed mt-2">${data.data[1].ayahs[i].text}</p></div>`;
            }
            document.getElementById('readerContent').innerHTML = html;
            trackAction(`Reading Surah ${name}`);
        } catch(e) {
            document.getElementById('readerContent').innerHTML = '<p class="text-center text-red-500 mt-10">Error loading. Check internet.</p>';
        }
    }

    // ========================
    // COUNTDOWN
    // ========================
    let cdInt;
    function openCountdown(name, time24) {
        trackAction(`Checked Countdown for ${name}`);
        const modal = document.getElementById('countdownModal');
        modal.classList.remove('hidden');
        document.getElementById('modalPrayerName').innerText = `${name} Starts In`;
        clearInterval(cdInt);
        const [h,m] = (time24||"00:00").split(':').map(Number);
        const target = new Date(); target.setHours(h,m,0,0);
        if(target < new Date()) target.setDate(target.getDate()+1);
        cdInt = setInterval(() => {
            const diff = target - new Date();
            if(diff <= 0) { document.getElementById('modalTimer').innerText = "Now!"; return; }
            const hrs = Math.floor(diff/3600000);
            const mins = Math.floor((diff%3600000)/60000);
            const secs = Math.floor((diff%60000)/1000);
            document.getElementById('modalTimer').innerText = `${String(hrs).padStart(2,'0')}:${String(mins).padStart(2,'0')}:${String(secs).padStart(2,'0')}`;
        }, 1000);
    }

    function closeCountdown() {
        document.getElementById('countdownModal').classList.add('hidden');
        clearInterval(cdInt);
    }
</script>
</body>
</html>
